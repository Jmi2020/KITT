# ==============================================================================
# KITTY Tool Registry
# ==============================================================================
# Central registry for all MCP tools with metadata, safety levels, and permissions
#
# Tool Definition Structure:
#   tool_name:
#     server: MCP server name (research, cad, homeassistant, memory, vision, broker)
#     description: Human-readable description
#     hazard_class: none | low | medium | high
#     requires_confirmation: true | false
#     budget_tier: free | paid | premium
#     enabled: true | false (optional, defaults to true)
#
# Hazard Classes:
#   - none: No safety concerns (web search, reading data)
#   - low: Minimal impact (CAD generation, memory storage)
#   - medium: Reversible actions (device control, print queue)
#   - high: Irreversible/dangerous (unlock doors, enable power)
#
# Budget Tiers:
#   - free: Local/free external APIs
#   - paid: Cloud LLM routing (Perplexity, GPT)
#   - premium: Expensive external services (Zoo CAD, Tripo)

version: 1

tools:
  # ==============================================================================
  # Research Tools (free, no hazards)
  # ==============================================================================

  web_search:
    server: research
    description: "Search the web for current information using SearXNG, Brave, or DuckDuckGo"
    hazard_class: none
    requires_confirmation: false
    budget_tier: free
    enabled: true

  fetch_webpage:
    server: research
    description: "Fetch and parse webpage content with Jina Reader or BeautifulSoup"
    hazard_class: none
    requires_confirmation: false
    budget_tier: free
    enabled: true

  research_deep:
    server: research
    description: "Deep research using Perplexity Sonar for comprehensive answers (paid API)"
    hazard_class: none
    requires_confirmation: false
    budget_tier: paid
    enabled: true
    requires_override: true  # Requires API_OVERRIDE_PASSWORD

  # ==============================================================================
  # Vision Tools (free, no hazards)
  # ==============================================================================

  image_search:
    server: vision
    description: "Search for images using DuckDuckGo or Google Images API"
    hazard_class: none
    requires_confirmation: false
    budget_tier: free
    enabled: true

  image_filter:
    server: vision
    description: "Filter and rank images using CLIP embeddings for relevance"
    hazard_class: none
    requires_confirmation: false
    budget_tier: free
    enabled: true

  store_selection:
    server: vision
    description: "Store selected images to MinIO for CAD reference or documentation"
    hazard_class: low
    requires_confirmation: false
    budget_tier: free
    enabled: true

  # ==============================================================================
  # Memory Tools (free, low hazard)
  # ==============================================================================

  remember:
    server: memory
    description: "Store information in long-term memory (Qdrant vector database)"
    hazard_class: low
    requires_confirmation: false
    budget_tier: free
    enabled: true

  search_memories:
    server: memory
    description: "Search long-term memory for relevant past conversations or facts"
    hazard_class: none
    requires_confirmation: false
    budget_tier: free
    enabled: true

  # ==============================================================================
  # CAD Tools (paid/premium, low-medium hazard)
  # ==============================================================================

  cad.generate_model:
    server: cad
    description: "Generate CAD model using Zoo.dev KittyCAD API (parametric)"
    hazard_class: low
    requires_confirmation: false
    budget_tier: premium
    enabled: true
    requires_override: true  # Requires API_OVERRIDE_PASSWORD for paid service

  cad.image_to_mesh:
    server: cad
    description: "Convert image to 3D mesh using Tripo AI (paid API)"
    hazard_class: low
    requires_confirmation: false
    budget_tier: premium
    enabled: true
    requires_override: true

  cad.local_generate:
    server: cad
    description: "Generate CAD locally using CadQuery or FreeCAD scripts"
    hazard_class: low
    requires_confirmation: false
    budget_tier: free
    enabled: true

  # ==============================================================================
  # Fabrication Tools (medium hazard - physical devices)
  # ==============================================================================

  fabrication.queue_print:
    server: broker
    description: "Queue 3D print/CNC/laser job with automatic printer selection based on model size and mode"
    hazard_class: medium
    requires_confirmation: true
    confirmation_phrase: "Confirm: proceed"
    budget_tier: free
    enabled: true
    note: |
      Automatically selects printer based on model size and mode:
      - Small-medium 3D prints (≤200mm) → Bamboo H2D
      - Large 3D prints (>200mm) → Elegoo Giga
      - CNC/laser → Snapmaker Artisan

      Parameters:
      - artifact_path (required): Path to STL/GCODE file
      - print_mode (optional): "3d_print" (default), "cnc", or "laser"
      - printer_id (optional): Manual printer selection override
      - nozzle_temp (optional): Nozzle temperature override
      - bed_temp (optional): Bed temperature override

  fabrication.list_printers:
    server: broker
    description: "List all available printers with status and capabilities"
    hazard_class: none
    requires_confirmation: false
    budget_tier: free
    enabled: true
    note: "Returns online status, current jobs, and build volume for all printers"

  fabrication.cancel_print:
    server: broker
    description: "Cancel currently running print job on specified printer"
    hazard_class: low
    requires_confirmation: false
    budget_tier: free
    enabled: true
    note: "Requires printer_id parameter (bamboo_h2d, elegoo_giga, or snapmaker_artisan)"

  fabrication.pause_print:
    server: broker
    description: "Pause currently running print job on specified printer"
    hazard_class: low
    requires_confirmation: false
    budget_tier: free
    enabled: true
    note: "Requires printer_id parameter"

  fabrication.resume_print:
    server: broker
    description: "Resume paused print job on specified printer"
    hazard_class: low
    requires_confirmation: false
    budget_tier: free
    enabled: true
    note: "Requires printer_id parameter"

  # ==============================================================================
  # Home Assistant Tools (medium-high hazard - physical control)
  # ==============================================================================

  homeassistant.turn_on:
    server: homeassistant
    description: "Turn on a Home Assistant entity (light, switch, etc.)"
    hazard_class: low
    requires_confirmation: false
    budget_tier: free
    enabled: true

  homeassistant.turn_off:
    server: homeassistant
    description: "Turn off a Home Assistant entity (light, switch, etc.)"
    hazard_class: low
    requires_confirmation: false
    budget_tier: free
    enabled: true

  homeassistant.activate_scene:
    server: homeassistant
    description: "Activate a Home Assistant scene (lighting preset)"
    hazard_class: low
    requires_confirmation: false
    budget_tier: free
    enabled: true

  homeassistant.unlock_door:
    server: homeassistant
    description: "Unlock smart lock via Home Assistant"
    hazard_class: high
    requires_confirmation: true
    confirmation_phrase: "Confirm: proceed"
    requires_signature: true
    budget_tier: free
    enabled: true
    note: "HIGH RISK: Unlocking doors has security implications. Requires signature verification."

  homeassistant.lock_door:
    server: homeassistant
    description: "Lock smart lock via Home Assistant"
    hazard_class: medium
    requires_confirmation: false
    budget_tier: free
    enabled: true

  homeassistant.enable_power:
    server: homeassistant
    description: "Enable high-power equipment (laser cutter, welder, etc.)"
    hazard_class: high
    requires_confirmation: true
    confirmation_phrase: "Confirm: proceed"
    requires_signature: true
    budget_tier: free
    enabled: true
    note: "HIGH RISK: Enabling dangerous equipment. Requires signature verification and zone presence check."

  # ==============================================================================
  # Command Broker Tools (system-level, medium hazard)
  # ==============================================================================

  broker.execute_command:
    server: broker
    description: "Execute system command via command broker with audit logging"
    hazard_class: medium
    requires_confirmation: true
    confirmation_phrase: "Confirm: proceed"
    budget_tier: free
    enabled: false  # Disabled by default for safety
    note: "System-level command execution. Enable only in controlled environments."

  # ==============================================================================
  # Reasoning Delegation (for dual-model architecture)
  # ==============================================================================

  reason_with_f16:
    server: reasoning
    description: "Delegate complex reasoning to F16 high-precision model (Llama 3.3 70B)"
    hazard_class: none
    requires_confirmation: false
    budget_tier: free
    enabled: true
    note: "Used by Q4 agent to request deep analysis from F16 reasoning engine."

# ==============================================================================
# Tool Categories (for UI/CLI filtering)
# ==============================================================================

categories:
  research: [web_search, fetch_webpage, research_deep]
  vision: [image_search, image_filter, store_selection]
  memory: [remember, search_memories]
  cad: [cad.generate_model, cad.image_to_mesh, cad.local_generate]
  fabrication: [fabrication.queue_print, fabrication.list_printers, fabrication.cancel_print, fabrication.pause_print, fabrication.resume_print]
  homeassistant: [homeassistant.turn_on, homeassistant.turn_off, homeassistant.activate_scene, homeassistant.unlock_door, homeassistant.lock_door, homeassistant.enable_power]
  broker: [broker.execute_command]
  reasoning: [reason_with_f16]

# ==============================================================================
# Safety Policies (global overrides)
# ==============================================================================

safety:
  # Require confirmation phrase for all hazard_class: high tools
  enforce_high_hazard_confirmation: true

  # Require API_OVERRIDE_PASSWORD for all budget_tier: paid/premium tools
  enforce_paid_override: true

  # Require signature verification for tools with requires_signature: true
  enforce_signature_verification: true

  # Default confirmation phrase (can be overridden per-tool)
  default_confirmation_phrase: "Confirm: proceed"

  # Enable audit logging for all tool executions
  audit_enabled: true
